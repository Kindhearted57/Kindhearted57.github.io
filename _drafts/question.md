Good day:)

Using web3 and ganache-cli, trying to test a contract with the bytecode of it.

 Here is part of the testing logic: first I deployed the token contract with `account[0]` by sending transaction to `null` with token's `bytecode + its constructor value` in `data` field. 

```
var tokenDeploymentReceipt = await web3.eth.sendTransaction({from:accounts[0],value:0,data:TokenBinCode,gas:100000000},function(error,hash){if (!error)console.log('Token deployed successfully')});
```

Then use `account[0]` to transfer a certain amount of token to `account[1]` by transferring to the token's address with data structed like this: `signatureof(transfer(address,uint256))+arg1+arg2`

```
var setupTransferReceipt = await web3.eth.sendTransaction({from:accounts[0],to:token_address,value:0,data:setupBinCode},function(error,hash){if (error)console.log(hash)});
```

```
async function Main(){
    accounts = await web3.eth.getAccounts()
    //Deploy the token
    var TokenBinCode = "0x60806040526040805190810160405280600b81526020017f5375706572456e657267790000000000000000000000000000000000000000008152506004908051906020019061004f929190610165565b506040805190810160405280600381526020017f53454300000000000000000000000000000000000000000000000000000000008152506005908051906020019061009b929190610165565b50600060065563b2d05e006007553480156100b557600080fd5b506040516020806110258339810180604052810190808051906020019092919050505080600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550600754600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055505061020a565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106101a657805160ff19168380011785556101d4565b828001600101855582156101d4579182015b828111156101d35782518255916020019190600101906101b8565b5b5090506101e191906101e5565b5090565b61020791905b808211156102035760008160009055506001016101eb565b5090565b90565b610e0c806102196000396000f3006080604052600436106100af576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806306fdde03146100b4578063095ea7b31461014457806318160ddd1461019157806323b872dd146101bc578063313ce5671461022957806370a08231146102545780638da5cb5b146102ab57806395d89b4114610302578063a9059cbb14610392578063dd62ed3e146103df578063f2fde38b14610456575b600080fd5b3480156100c057600080fd5b506100c9610499565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156101095780820151818401526020810190506100ee565b50505050905090810190601f1680156101365780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561015057600080fd5b5061018f600480360381019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050610537565b005b34801561019d57600080fd5b506101a66106b9565b6040518082815260200191505060405180910390f35b3480156101c857600080fd5b50610227600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803590602001909291905050506106bf565b005b34801561023557600080fd5b5061023e61097f565b6040518082815260200191505060405180910390f35b34801561026057600080fd5b50610295600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610985565b6040518082815260200191505060405180910390f35b3480156102b757600080fd5b506102c06109ce565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561030e57600080fd5b506103176109f4565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561035757808201518184015260208101905061033c565b50505050905090810190601f1680156103845780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561039e57600080fd5b506103dd600480360381019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050610a92565b005b3480156103eb57600080fd5b50610440600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610c3c565b6040518082815260200191505060405180910390f35b34801561046257600080fd5b50610497600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610cc3565b005b60048054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561052f5780601f106105045761010080835404028352916020019161052f565b820191906000526020600020905b81548152906001019060200180831161051257829003601f168201915b505050505081565b600081141580156105c557506000600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205414155b156105cf57600080fd5b80600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925836040518082815260200191505060405180910390a35050565b60075481565b6000606060048101600036905010156106d757600080fd5b600260008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205491506107a883600160008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610d9a90919063ffffffff16565b600160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555061083d83600160008873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610db890919063ffffffff16565b600160008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055506108938383610db890919063ffffffff16565b600260008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508373ffffffffffffffffffffffffffffffffffffffff168573ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef856040518082815260200191505060405180910390a35050505050565b60065481565b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60058054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610a8a5780601f10610a5f57610100808354040283529160200191610a8a565b820191906000526020600020905b815481529060010190602001808311610a6d57829003601f168201915b505050505081565b60406004810160003690501015610aa857600080fd5b610afa82600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610db890919063ffffffff16565b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550610b8f82600160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610d9a90919063ffffffff16565b600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040518082815260200191505060405180910390a3505050565b6000600260008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515610d1f57600080fd5b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16141515610d975780600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b50565b6000808284019050610dae84821015610dd1565b8091505092915050565b6000610dc683831115610dd1565b818303905092915050565b801515610ddd57600080fd5b505600a165627a7a72305820f3e824a84944e45c5ab6d5e2f35344f5a6958eecedbec65842f12ba5e31da2cf002900000000000000000000000076F4d3cE032CFBB66440A90c6F0A2EB2060fc528"         
    var tokenDeploymentReceipt = await web3.eth.sendTransaction({from:accounts[0],value:0,data:TokenBinCode,gas:100000000},function(error,hash){if (!error)console.log('Token deployed successfully')});
    console.log(tokenDeploymentReceipt)
    const token_address = tokenDeploymentReceipt.contractAddress
    web3.eth.getTransaction(tokenDeploymentReceipt.transactionHash)
.then(console.log);
    console.log(token_address)
    //Use accounts[0] to transfer this token to accounts[1]
    var setupBinCode = "0xa9059cbb000000000000000000000000"+accounts[1].replace('0x','')+"0000000000000000000000000000000000000000000000000000000000000064";
    var setupTransferReceipt = await web3.eth.sendTransaction({from:accounts[0],to:token_address,value:0,data:setupBinCode},function(error,hash){if (error)console.log(hash)});
    var setupTransferResult = setupTransferReceipt.status
    console.log(setupTransferReceipt)
}
Main().then()
```
So here is my problem: the second transaction will revert:

```
(node:13035) UnhandledPromiseRejectionWarning: c: VM Exception while processing transaction: revert
    at Function.c.fromResults (/home/jr/node_modules/ganache-cli/build/ganache-core.node.cli.js:2:157333)
    at A.processBlock (/home/jr/node_modules/ganache-cli/build/ganache-core.node.cli.js:17:121734)
    at processTicksAndRejections (internal/process/task_queues.js:85:5)
```

 however, if I collected the value of `token_address` from `console.log(token_address)` and use it for the transaction like this
```
async function Main(){
    accounts = await web3.eth.getAccounts()
    var setupBinCode = "0xa9059cbb000000000000000000000000"+accounts[1].replace('0x','')+"0000000000000000000000000000000000000000000000000000000000000064";
    var setupTransferReceipt = await web3.eth.sendTransaction({from:accounts[0],to:'0x78CeD0AB57c87547B47Bd0cCD2e8B688e2185999',value:0,data:setupBinCode},function(error,hash){if (error)console.log(hash)});
    console.log(setupTransferReceipt)
}
Main().then()
```
This transaction will success, as `console.log(seutupTransferReceipt)` returns:
```
{
  transactionHash: '0x80d4d694b49c897856fab4b5586c8aa09be81e98905a1634401e6ee3a9272466',
  transactionIndex: 0,
  blockHash: '0xe73f85fa576ed38e4f8ba43302b1a53db2b895d797b2e51db51a916c3388adc8',
  blockNumber: 3,
  from: '0x553054b66ab3fe0885a914ea2da93b78fdf5c73f',
  to: '0x78ced0ab57c87547b47bd0ccd2e8b688e2185999',
  gasUsed: 21572,
  cumulativeGasUsed: 21572,
  contractAddress: null,
  logs: [],
  status: true,
  logsBloom: '0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'
}

```
 I don't understand why my previous code will lead to revert of the second transcation.
Here are the something I have done:

 - I have checked the type,value of `token_address` and there isn't anything wrong.

 - I thought maybe the transaction has not been mined into the block, so only when I send the transaction again in another async function will it success. However, `web3.eth.getTransaction(tokenDeploymentReceipt.transactionHash).then(console.log)` returns the result like this

```
{
  hash: '0x6adde134fe414cc6dabedea7978924ceaf2cb4d8c790c813a15fb6d4c5158a9b',
  nonce: 1,
  blockHash: '0xd94392bcfd8268289fe19c9f88640868c21f67173c7d395fa7226819472c3acb',
  blockNumber: 2,
  transactionIndex: 0,
  from: '0x2C7aBE5816e58Cfa0F373373a501dE2B521FC447',
  to: null,
  value: '0',
  gas: 100000000,
  gasPrice: '2000000000',
  input: '0x60806040526040805190810160405280600b81526020017f5375706572456e657267790000000000000000000000000000000000000000008152506004908051906020019061004f929190610165565b506040805190810160405280600381526020017f53454300000000000000000000000000000000000000000000000000000000008152506005908051906020019061009b929190610165565b50600060065563b2d05e006007553480156100b557600080fd5b506040516020806110258339810180604052810190808051906020019092919050505080600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550600754600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055505061020a565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106101a657805160ff19168380011785556101d4565b828001600101855582156101d4579182015b828111156101d35782518255916020019190600101906101b8565b5b5090506101e191906101e5565b5090565b61020791905b808211156102035760008160009055506001016101eb565b5090565b90565b610e0c806102196000396000f3006080604052600436106100af576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806306fdde03146100b4578063095ea7b31461014457806318160ddd1461019157806323b872dd146101bc578063313ce5671461022957806370a08231146102545780638da5cb5b146102ab57806395d89b4114610302578063a9059cbb14610392578063dd62ed3e146103df578063f2fde38b14610456575b600080fd5b3480156100c057600080fd5b506100c9610499565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156101095780820151818401526020810190506100ee565b50505050905090810190601f1680156101365780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561015057600080fd5b5061018f600480360381019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050610537565b005b34801561019d57600080fd5b506101a66106b9565b6040518082815260200191505060405180910390f35b3480156101c857600080fd5b50610227600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803590602001909291905050506106bf565b005b34801561023557600080fd5b5061023e61097f565b6040518082815260200191505060405180910390f35b34801561026057600080fd5b50610295600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610985565b6040518082815260200191505060405180910390f35b3480156102b757600080fd5b506102c06109ce565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561030e57600080fd5b506103176109f4565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561035757808201518184015260208101905061033c565b50505050905090810190601f1680156103845780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561039e57600080fd5b506103dd600480360381019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050610a92565b005b3480156103eb57600080fd5b50610440600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610c3c565b6040518082815260200191505060405180910390f35b34801561046257600080fd5b50610497600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610cc3565b005b60048054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561052f5780601f106105045761010080835404028352916020019161052f565b820191906000526020600020905b81548152906001019060200180831161051257829003601f168201915b505050505081565b600081141580156105c557506000600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205414155b156105cf57600080fd5b80600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925836040518082815260200191505060405180910390a35050565b60075481565b6000606060048101600036905010156106d757600080fd5b600260008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205491506107a883600160008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610d9a90919063ffffffff16565b600160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555061083d83600160008873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610db890919063ffffffff16565b600160008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055506108938383610db890919063ffffffff16565b600260008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508373ffffffffffffffffffffffffffffffffffffffff168573ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef856040518082815260200191505060405180910390a35050505050565b60065481565b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60058054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610a8a5780601f10610a5f57610100808354040283529160200191610a8a565b820191906000526020600020905b815481529060010190602001808311610a6d57829003601f168201915b505050505081565b60406004810160003690501015610aa857600080fd5b610afa82600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610db890919063ffffffff16565b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550610b8f82600160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610d9a90919063ffffffff16565b600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040518082815260200191505060405180910390a3505050565b6000600260008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515610d1f57600080fd5b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16141515610d975780600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b50565b6000808284019050610dae84821015610dd1565b8091505092915050565b6000610dc683831115610dd1565b818303905092915050565b801515610ddd57600080fd5b505600a165627a7a72305820f3e824a84944e45c5ab6d5e2f35344f5a6958eecedbec65842f12ba5e31da2cf002900000000000000000000000076f4d3ce032cfbb66440a90c6f0a2eb2060fc528',
  v: '0x25',
  r: '0x31eb4971b087eec272d0b6ab73fa27511c35288ac500f36379460d8004d47cc3',
  s: '0x50347581a449ee9fe598dfd3c9a8e15dcd901c91309f2a65894c7968045e188f'
}

``` 
So this means the transaction has already been mined. 

I can not find another reason for this problem.

I have struggled for days, so really thanks for anyone who can help me about this. 